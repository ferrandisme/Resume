---
interface Props {
  label: string;
  lightText: string;
  darkText: string;
}

const { label, lightText, darkText } = Astro.props;
---

<button
  type="button"
  class="theme-toggle"
  data-theme-toggle
  aria-label={label}
  data-light-text={lightText}
  data-dark-text={darkText}
>
  <span class="theme-toggle-icon" data-theme-icon aria-hidden="true">☀</span>
  <span class="theme-toggle-label" data-theme-label>{lightText}</span>
</button>

<script is:inline>
  const applyThemeLabel = (button) => {
    const currentTheme = document.documentElement.dataset.theme || 'light';
    const label = button.querySelector('[data-theme-label]');
    const icon = button.querySelector('[data-theme-icon]');
    if (!label) return;

    const htmlLang = document.documentElement.lang || 'en';
    const isSpanish = htmlLang.toLowerCase().startsWith('es');
    const fallbackLight = isSpanish ? 'Claro' : 'Light';
    const fallbackDark = isSpanish ? 'Oscuro' : 'Dark';

    const lightText = button.getAttribute('data-light-text') || fallbackLight;
    const darkText = button.getAttribute('data-dark-text') || fallbackDark;
    const isDark = currentTheme === 'dark';
    label.textContent = isDark ? darkText : lightText;

    if (icon instanceof HTMLElement) {
      icon.textContent = isDark ? '☾' : '☀';
    }
  };

  const initThemeToggle = () => {
    const button = document.querySelector('[data-theme-toggle]');
    if (!(button instanceof HTMLButtonElement)) return;

    applyThemeLabel(button);

    button.addEventListener('click', () => {
      const current = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'light';
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.dataset.theme = next;
      localStorage.setItem('theme', next);
      applyThemeLabel(button);
    });
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initThemeToggle, { once: true });
  } else {
    initThemeToggle();
  }
</script>
